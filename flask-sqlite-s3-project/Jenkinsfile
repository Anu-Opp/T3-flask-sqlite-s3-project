pipeline {
    agent {
        label 'amazon-linux' // Ensure this matches your agent label
    }

    environment {
        S3_BUCKET = 't3-flask-app-artifacts'
        ARTIFACT_NAME = "flask-app-${BUILD_NUMBER}.zip"
        AWS_REGION = 'us-east-1'
        ANSIBLE_PATH = "${WORKSPACE}/flask-sqlite-s3-project/ansible" // Change if needed
    }

    stages {
        stage('Checkout') {
            steps {
                git credentialsId: 'git-credentials',
                    url: 'https://github.com/Anu-Opp/T3-flask-sqlite-s3-project.git',
                    branch: 'main'
                sh 'ls -l'
            }
        }

        stage('Install Dependencies') {
            steps {
                sh 'pip3 install -r flask-sqlite-s3-project/requirements.txt'
            }
        }

        stage('Test') {
            steps {
                dir('flask-sqlite-s3-project') {
                    sh 'python3 -m pytest || echo "No tests available"
